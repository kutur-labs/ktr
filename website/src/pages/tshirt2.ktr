input neck_to_shoulder_top_height = 40mm
input shoulder_top_to_chest_height = 180mm
input chest_to_waist_height = 240mm
input waist_to_bottom_height = 100mm
input shoulder_width = 170mm
input front_neckhole_depth = 30mm
input back_neckhole_depth = 20mm
input armhole_depth = 55mm
input chest_width = 580mm
input sleeve_piece_length = 190mm
input sleeve_bicep_ease = 20mm
input sleeve_taper = 55mm
input sleeve_cap_height_ratio = 0.62

fn x_mid() {
  return chest_width / 2
}

fn y_sleeve() {
  return neck_to_shoulder_top_height
}

fn y_chest() {
  return neck_to_shoulder_top_height + shoulder_top_to_chest_height
}

fn y_waist() {
  return y_chest() + chest_to_waist_height
}

fn y_bottom() {
  return y_waist() + waist_to_bottom_height
}

fn armhole_height() {
  return y_chest() - y_sleeve()
}

fn x_armhole_right() {
  return chest_width - armhole_depth
}

fn x_neck_left() {
  return armhole_depth + shoulder_width
}

fn x_neck_right() {
  return chest_width - armhole_depth - shoulder_width
}

fn sleeve_bicep_width() {
  // simple set-in sleeve approximation from bodice armhole geometry
  return armhole_height() + (armhole_depth * 2) + sleeve_bicep_ease
}

fn sleeve_hem_width() {
  return sleeve_bicep_width() - sleeve_taper
}

fn sleeve_cap_height() {
  return armhole_height() * sleeve_cap_height_ratio
}

fn sleeve_cap_outer_cp_y() {
  // keep this close to the underarm for a smooth lift from side seam
  return sleeve_cap_height() * (0.78 + ((1.0 - sleeve_cap_height_ratio) * 0.12))
}

fn sleeve_cap_inner_cp_y() {
  // keep inner controls on crown level so both beziers join smoothly at top_middle_point
  return 0mm
}

fn sleeve_cap_outer_cp_x_ratio() {
  // low cap: spread controls outward, high cap: pull inward
  return 0.14 + ((1.0 - sleeve_cap_height_ratio) * 0.06)
}

fn sleeve_cap_inner_cp_x_ratio() {
  // higher cap ratio brings inner controls in for a taller crown
  return 0.36 - ((sleeve_cap_height_ratio - 0.5) * 0.1)
}

piece front_tshirt {
  top_left_point = point(0mm, 0mm)
  top_middle_point = point(x_mid(), 0mm)
  top_right_point = point(chest_width, 0mm)

  sleeve_left_point = point(0mm, y_sleeve())
  sleeve_middle_point = point(x_mid(), y_sleeve())
  sleeve_right_point = point(chest_width, y_sleeve())

  chest_left_point = point(0mm, y_chest())
  chest_middle_point = point(x_mid(), y_chest())
  chest_right_point = point(chest_width, y_chest())

  waist_left_point = point(0mm, y_waist())
  waist_middle_point = point(x_mid(), y_waist())
  waist_right_point = point(chest_width, y_waist())

  bottom_left_point = point(0mm, y_bottom())
  bottom_middle_point = point(x_mid(), y_bottom())
  bottom_right_point = point(chest_width, y_bottom())
  bottom_left_line = line(bottom_left_point, bottom_middle_point)
  bottom_right_line = line(bottom_middle_point, bottom_right_point)

  top_armhole_left_point = point(armhole_depth, 0mm)
  sleeve_armhole_left_point = point(armhole_depth, y_sleeve())
  chest_armhole_left_point = point(armhole_depth, y_chest())

  top_armhole_right_point = point(x_armhole_right(), 0mm)
  sleeve_armhole_right_point = point(x_armhole_right(), y_sleeve())
  chest_armhole_right_point = point(x_armhole_right(), y_chest())

  sleeve_left_curve_cp1 = point(chest_armhole_left_point.x, chest_armhole_left_point.y)
  sleeve_left_curve_cp2 = point(armhole_depth + 30mm, 100mm + y_sleeve())
  sleeve_left_curve = bezier(chest_left_point, sleeve_left_curve_cp1, sleeve_left_curve_cp2, sleeve_armhole_left_point)

  sleeve_right_curve_cp1 = point(chest_armhole_right_point.x, chest_armhole_right_point.y)
  sleeve_right_curve_cp2 = point(chest_width - armhole_depth - 30mm, 100mm + y_sleeve())
  sleeve_right_curve = bezier(chest_right_point, sleeve_right_curve_cp1, sleeve_right_curve_cp2, sleeve_armhole_right_point)

  top_neckhole_left_point = point(x_neck_left(), 0mm)
  bottom_neckhole_left_point = point(x_neck_left(), y_sleeve() + front_neckhole_depth)
  top_neckhole_right_point = point(x_neck_right(), 0mm)
  bottom_neckhole_right_point = point(x_neck_right(), y_sleeve() + front_neckhole_depth)
  bottom_neckhole_mid_point = point(x_mid(), y_sleeve() + front_neckhole_depth)

  neck_left_curve_cp1 = point(top_neckhole_left_point.x - 10mm, front_neckhole_depth + 10mm)
  neck_left_curve_cp2 = point(top_neckhole_left_point.x + 10mm, bottom_neckhole_mid_point.y)
  neck_left_curve = bezier(top_neckhole_left_point, neck_left_curve_cp1, neck_left_curve_cp2, bottom_neckhole_mid_point)

  neck_right_curve_cp1 = point(top_neckhole_right_point.x + 10mm, front_neckhole_depth + 10mm)
  neck_right_curve_cp2 = point(top_neckhole_right_point.x - 10mm, bottom_neckhole_mid_point.y)
  neck_right_curve = bezier(top_neckhole_right_point, neck_right_curve_cp1, neck_right_curve_cp2, bottom_neckhole_mid_point)

  shoulder_left_line = line(top_neckhole_left_point, sleeve_armhole_left_point)
  shoulder_right_line = line(top_neckhole_right_point, sleeve_armhole_right_point)

  side_left_line = line(chest_left_point, waist_left_point)
  side_right_line = line(chest_right_point, waist_right_point)

  hem_left_line = line(waist_left_point, bottom_left_point)
  hem_right_line = line(waist_right_point, bottom_right_point)
}

piece back_tshirt {
  top_left_point = point(0mm, 0mm)
  top_middle_point = point(x_mid(), 0mm)
  top_right_point = point(chest_width, 0mm)

  sleeve_left_point = point(0mm, y_sleeve())
  sleeve_middle_point = point(x_mid(), y_sleeve())
  sleeve_right_point = point(chest_width, y_sleeve())

  chest_left_point = point(0mm, y_chest())
  chest_middle_point = point(x_mid(), y_chest())
  chest_right_point = point(chest_width, y_chest())

  waist_left_point = point(0mm, y_waist())
  waist_middle_point = point(x_mid(), y_waist())
  waist_right_point = point(chest_width, y_waist())

  bottom_left_point = point(0mm, y_bottom())
  bottom_middle_point = point(x_mid(), y_bottom())
  bottom_right_point = point(chest_width, y_bottom())
  bottom_left_line = line(bottom_left_point, bottom_middle_point)
  bottom_right_line = line(bottom_middle_point, bottom_right_point)

  top_armhole_left_point = point(armhole_depth, 0mm)
  sleeve_armhole_left_point = point(armhole_depth, y_sleeve())
  chest_armhole_left_point = point(armhole_depth, y_chest())

  top_armhole_right_point = point(x_armhole_right(), 0mm)
  sleeve_armhole_right_point = point(x_armhole_right(), y_sleeve())
  chest_armhole_right_point = point(x_armhole_right(), y_chest())

  sleeve_left_curve_cp1 = point(chest_armhole_left_point.x, chest_armhole_left_point.y)
  sleeve_left_curve_cp2 = point(armhole_depth + 30mm, 100mm + y_sleeve())
  sleeve_left_curve = bezier(chest_left_point, sleeve_left_curve_cp1, sleeve_left_curve_cp2, sleeve_armhole_left_point)

  sleeve_right_curve_cp1 = point(chest_armhole_right_point.x, chest_armhole_right_point.y)
  sleeve_right_curve_cp2 = point(chest_width - armhole_depth - 30mm, 100mm + y_sleeve())
  sleeve_right_curve = bezier(chest_right_point, sleeve_right_curve_cp1, sleeve_right_curve_cp2, sleeve_armhole_right_point)

  top_neckhole_left_point = point(x_neck_left(), 0mm)
  top_neckhole_right_point = point(x_neck_right(), 0mm)

  back_neck_curve_cp1 = point(x_neck_left() + 40mm, back_neckhole_depth)
  back_neck_curve_cp2 = point(x_neck_right() - 40mm, back_neckhole_depth)
  back_neck_curve = bezier(top_neckhole_left_point, back_neck_curve_cp1, back_neck_curve_cp2, top_neckhole_right_point)

  shoulder_left_line = line(top_neckhole_left_point, sleeve_armhole_left_point)
  shoulder_right_line = line(top_neckhole_right_point, sleeve_armhole_right_point)

  side_left_line = line(chest_left_point, waist_left_point)
  side_right_line = line(chest_right_point, waist_right_point)

  hem_left_line = line(waist_left_point, bottom_left_point)
  hem_right_line = line(waist_right_point, bottom_right_point)
}

piece sleeve {
  top_left_point = point(0mm, sleeve_cap_height())
  top_middle_point = point(sleeve_bicep_width() / 2, 0mm)
  top_right_point = point(sleeve_bicep_width(), sleeve_cap_height())

  cap_left_curve_cp1 = point(sleeve_bicep_width() * sleeve_cap_outer_cp_x_ratio(), sleeve_cap_outer_cp_y())
  cap_left_curve_cp2 = point(sleeve_bicep_width() * sleeve_cap_inner_cp_x_ratio(), sleeve_cap_inner_cp_y())
  cap_left_curve = bezier(top_left_point, cap_left_curve_cp1, cap_left_curve_cp2, top_middle_point)

  cap_right_curve_cp1 = point(sleeve_bicep_width() * (1.0 - sleeve_cap_inner_cp_x_ratio()), sleeve_cap_inner_cp_y())
  cap_right_curve_cp2 = point(sleeve_bicep_width() * (1.0 - sleeve_cap_outer_cp_x_ratio()), sleeve_cap_outer_cp_y())
  cap_right_curve = bezier(top_middle_point, cap_right_curve_cp1, cap_right_curve_cp2, top_right_point)

  bottom_y = sleeve_cap_height() + sleeve_piece_length
  bottom_left_point = point((sleeve_bicep_width() - sleeve_hem_width()) / 2, bottom_y)
  bottom_middle_point = point(sleeve_bicep_width() / 2, bottom_y)
  bottom_right_point = point((sleeve_bicep_width() + sleeve_hem_width()) / 2, bottom_y)

  side_left_line = line(top_left_point, bottom_left_point)
  side_right_line = line(top_right_point, bottom_right_point)
  hem_line = line(bottom_left_point, bottom_right_point)
}
